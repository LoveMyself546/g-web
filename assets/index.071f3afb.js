import{_ as a,P as x}from"./vendor.9d5ac3d8.js";const q=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}};q();class L{constructor(t){this.hidpp=t}getSensorCount(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(8705),o=yield this.hidpp.request(17,t,0);return new Uint8Array(o)[0]})}getDpiList(t){return a(this,void 0,void 0,function*(){if(yield this.hidpp.getVersion(),this.hidpp.version===1)throw new Error("Not Implemented");{const{index:o}=yield this.hidpp.getFeature(8705),i=yield this.hidpp.request(17,o,1,new Uint8Array([t]).buffer),n=new DataView(i);let s=[],r;for(let c=1;c<=1+14;c+=2){const d=n.getUint16(c);if(d===0)break;if(d>>13==7){r=d&8191;continue}s.push(d)}if(r){const c=[];for(let d=s[0];d<=s[1];d+=r)c.push(d);return c}else return s}})}getDpi(t){return a(this,void 0,void 0,function*(){if(yield this.hidpp.getVersion(),this.hidpp.version===1)throw new Error("Not Implemented");{const{index:o}=yield this.hidpp.getFeature(8705),i=yield this.hidpp.request(17,o,2,new Uint8Array([t]).buffer);return new DataView(i).getUint16(1)}})}setDpi(t,o){return a(this,void 0,void 0,function*(){if(yield this.hidpp.getVersion(),this.hidpp.version===1)throw new Error("Not Implemented");{const{index:i}=yield this.hidpp.getFeature(8705),n=new ArrayBuffer(3);let s=new DataView(n);s.setUint8(0,t),s.setUint16(1,o);const r=yield this.hidpp.request(17,i,3,n);return s=new DataView(r),s.getUint16(1)}})}}var m;(function(e){e[e.Discharging=0]="Discharging",e[e.Recharging=1]="Recharging",e[e.AlmostFull=2]="AlmostFull",e[e.Charged=3]="Charged",e[e.SlowRecharge=4]="SlowRecharge",e[e.InvalidBattery=5]="InvalidBattery",e[e.TerminalError=6]="TerminalError"})(m||(m={}));class F{constructor(t){this.hidpp=t}getBattery(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(4096),o=yield this.hidpp.request(17,t,0),i=new Uint8Array(o);return{level:i[0],nextLevel:i[1],status:i[2]}})}}new TextDecoder;class _{constructor(t=!1){this.list=[],this.blocking=t}wait(){if(!this.blocking&&(this.blocking=!0,this.list.length===0))return Promise.resolve();const t=new x;return this.list.push(t),t.promise}notify(){this.list.length!==0?this.list.pop().resolve():this.blocking=!1}dispose(){for(const t of this.list)t.reject(new Error("The Mutex has been disposed"));this.list.length=0}}const P=!0,V={vendorId:1133};var u;(function(e){e[e.Success=0]="Success",e[e.InvalidCommand=1]="InvalidCommand",e[e.InvalidAddress=2]="InvalidAddress",e[e.InvalidValue=3]="InvalidValue",e[e.ConnectFail=4]="ConnectFail",e[e.TooManyDevices=5]="TooManyDevices",e[e.AlreadyExists=6]="AlreadyExists",e[e.Busy=7]="Busy",e[e.UnknownDevice=8]="UnknownDevice",e[e.ResourceError=9]="ResourceError",e[e.RequestUnavailable=10]="RequestUnavailable",e[e.InvalidParamValue=11]="InvalidParamValue",e[e.WrongPinCode=12]="WrongPinCode"})(u||(u={}));const D={[u.Success]:"No error",[u.InvalidCommand]:"Invalid command",[u.InvalidAddress]:"Invalid address",[u.InvalidValue]:"Invalid value",[u.ConnectFail]:"Connection request failed (Receiver)",[u.TooManyDevices]:"Too many devices connected (Receiver)",[u.AlreadyExists]:"Already exists (Receiver)",[u.Busy]:"Busy (Receiver)",[u.UnknownDevice]:"Unknown device (Receiver)",[u.ResourceError]:"Resource error (Receiver)",[u.RequestUnavailable]:"Request not valid in current context",[u.InvalidParamValue]:"Request parameter has unsupported value",[u.WrongPinCode]:"The PIN code entered on the device was wrong"};function E(...e){let t=0;for(const n of e)n&&(t+=n.byteLength);const o=new Uint8Array(t);let i=0;for(const n of e)n&&(o.set(new Uint8Array(n),i),i+=n.byteLength);return o.buffer}class A{constructor(t,o,i){this._mutex=new _,this._featureIdToIndex={},this.handleInputReport=({data:n})=>{const s=new Uint8Array(n.buffer);if(s[0]!==this.index)return;const c=this._request;if(!c)return;let d=s[1];if(d===143){d=s[2];const l=s[3];if(c.command===d&&c.address===l){const v=s[4];console.error("error",d.toString(16),l.toString(16),v);const f=new Error(D[v]);f.name="Hidpp1Error",f.code=v,c.resolver.reject(f),this._request=void 0}return}const h=s[2];if(c.command===d&&c.address===h){const l=n.buffer.slice(3);console.log("response",d.toString(16),(this.version===2?h>>4:h).toString(16),Array.from(new Uint8Array(l))),c.resolver.resolve(l),this._request=void 0}},this.device=t,this.index=o,this.receiver=i,this.index===255&&this.device.addEventListener("inputreport",this.handleInputReport),this.receiver&&(this._mutex=this.receiver._mutex)}getVersion(){return a(this,void 0,void 0,function*(){if(this.version)return;if(this.device.opened||(yield this.device.open()),!this.device.collections.some(o=>{var i;return(i=o.outputReports)===null||i===void 0?void 0:i.some(n=>n.reportId===17)}))this.version=1;else{const o=new x,i=0,n=1<<4;this._request={command:i,address:n,resolver:o},yield this.device.sendReport(17,new Uint8Array([this.index,i,n]));try{yield o.promise,this.version=2}catch(s){if(s instanceof Error&&s.name==="Hidpp1Error"&&s.code===u.InvalidCommand)this.version=1;else throw s}}})}getFeature(t){return a(this,void 0,void 0,function*(){if(yield this.getVersion(),this.version===1)throw new Error("Feature not supported in HID++ 1.0");if(this._featureIdToIndex[t])return this._featureIdToIndex[t];const o=new ArrayBuffer(2);new DataView(o).setUint16(0,t);const i=yield this.request(17,0,0,o),n=new Uint8Array(i),s=n[0];if(s===0)throw new Error("Feature not supported");const r=n[2];return this._featureIdToIndex[t]={index:s,version:r},{index:s,version:r}})}request(t,o,i,n){return a(this,void 0,void 0,function*(){if(!this.version)throw new Error("Unknown device version");yield this._mutex.wait();try{this.device.opened||(yield this.device.open()),P&&console.log("request",o.toString(16),i.toString(16),n?Array.from(new Uint8Array(n)):""),this.version===2&&(i=i<<4);const s=new x;return this._request={command:o,address:i,resolver:s},yield this.device.sendReport(t,E(new Uint8Array([this.index,o,i]),n)),yield s.promise}finally{this._mutex.notify()}})}}function U(e){return e.collections.some(t=>t.usagePage===65347||t.usagePage===65280)}function N(){return a(this,void 0,void 0,function*(){const e=yield window.navigator.hid.requestDevice({filters:[V]});if(e.length===0)throw new Error("No device selected");const t=e.find(U);if(!t)throw new Error("Device not recognized");return t})}class C{constructor(t){this.children=[],this.handleInputReport=({data:o})=>{var i;const s=new Uint8Array(o.buffer)[0];s!==255&&((i=this.children[s])===null||i===void 0||i.handleInputReport({data:o}))},this.hidpp=t,this.hidpp.device.addEventListener("inputreport",this.handleInputReport)}getChildIndices(){return a(this,void 0,void 0,function*(){if(yield this.hidpp.getVersion(),this.hidpp.version!==1)throw new Error("Unsupported version");const t=yield this.hidpp.request(16,129,2),o=new Uint8Array(t)[1],i=[];for(let n=0;n<8;n++)o&1<<n&&i.push(n+1);return i})}getChild(t){return this.children[t]||(this.children[t]=new A(this.hidpp.device,t,this.hidpp)),this.children[t]}}class k{constructor(t){this.hidpp=t}getReportRateList(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(32864),o=yield this.hidpp.request(17,t,0),n=new Uint8Array(o)[0],s=[];for(let r=0;r<8;r+=1)n&1<<r&&s.push(r+1);return s})}getReportRate(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(32864),o=yield this.hidpp.request(17,t,1);return new Uint8Array(o)[0]})}setReportRate(t){return a(this,void 0,void 0,function*(){const{index:o}=yield this.hidpp.getFeature(32864);yield this.hidpp.request(17,o,2,new Uint8Array([t]))})}}const M=new TextDecoder;var y;(function(e){e[e.Keyboard=0]="Keyboard",e[e.RemoteControl=1]="RemoteControl",e[e.Numpad=2]="Numpad",e[e.Mouse=3]="Mouse",e[e.TouchPad=4]="TouchPad",e[e.Trackball=5]="Trackball",e[e.Presenter=6]="Presenter",e[e.Remote=7]="Remote",e[e.Receiver=8]="Receiver"})(y||(y={}));class T{constructor(t){this.hidpp=t}getNameLength(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(5),o=yield this.hidpp.request(17,t,0);return new Uint8Array(o)[0]})}getName(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(5),o=yield this.getNameLength();let i=new Uint8Array(o);for(let n=0;n<o;n+=16){const s=yield this.hidpp.request(17,t,1,new Uint8Array([n]).buffer);i.set(new Uint8Array(s,0,Math.min(o-n,16)),n)}return M.decode(i)})}getType(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(5),o=yield this.hidpp.request(17,t,2);return new Uint8Array(o)[0]})}}const g=document.getElementById("settings"),I=[];async function b(e){if(I.includes(e))return;I.push(e),console.log(e);const t=new A(e,255);await t.getVersion(),console.log(t);const o=[];if(t.version===1){const i=new C(t),n=await i.getChildIndices();console.log(n);for(const s of n){const r=i.getChild(s);o.push(r)}}else o.push(t);for(const i of o){console.log(i);const n=document.createElement("div"),s=new T(i);n.textContent=await s.getName(),g.appendChild(n);{const r=document.createElement("div");r.textContent=`Type: ${y[await s.getType()]}`,g.appendChild(r)}try{const r=new F(i),{level:c,nextLevel:d,status:h}=await r.getBattery(),l=document.createElement("div");l.textContent=`Battery: about ${c}%, ${m[h]}`,g.appendChild(l)}catch{console.log(n,"does not support battery")}try{const r=new L(i),c=await r.getSensorCount();console.log("sensorCount",c);for(let d=0;d<c;d+=1){const h=d,l=await r.getDpiList(h);console.log(l);const v=await r.getDpi(h);console.log(v);const f=document.createElement("div");f.textContent=`Sensor ${h} DPI: `;const p=document.createElement("select");for(const R of l){const w=document.createElement("option");w.value=R.toString(),w.innerText=R.toString(),p.appendChild(w)}p.value=v.toString(),p.onchange=async()=>{console.log(p.value),await r.setDpi(h,parseInt(p.value,10))},f.appendChild(p),g.appendChild(f)}}catch{}try{const r=new k(i),c=await r.getReportRateList(),d=await r.getReportRate(),h=document.createElement("div");h.textContent="Report Rate: ";const l=document.createElement("select");for(const v of c){const f=document.createElement("option");f.value=v.toString(),f.innerText=`${v}ms`,l.appendChild(f)}l.value=d.toString(),l.onchange=async()=>{console.log(l.value),await r.setReportRate(parseInt(l.value,10))},h.appendChild(l),g.appendChild(h)}catch(r){console.error(r)}}}(async()=>{const e=await navigator.hid.getDevices();for(const t of e)U(t)&&await b(t)})();document.getElementById("select-button").onclick=async()=>{const e=await N();I.includes(e)||(console.log(e),await b(e))};
