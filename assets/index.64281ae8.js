import{_ as a,a as E,b as v,P as w,E as x}from"./vendor.241a3de2.js";const D=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}};D();class ${constructor(t){this.hidpp=t}getSensorCount(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(8705),i=yield this.hidpp.request(17,t,0);return new Uint8Array(i)[0]})}getDpiList(t){return a(this,void 0,void 0,function*(){if(yield this.hidpp.getVersion(),this.hidpp.version===1)throw new Error("Not Implemented");{const{index:i}=yield this.hidpp.getFeature(8705),r=yield this.hidpp.request(17,i,1,new Uint8Array([t]).buffer),n=new DataView(r);let s=[],o;for(let d=1;d<=1+14;d+=2){const c=n.getUint16(d);if(c===0)break;if(c>>13==7){o=c&8191;continue}s.push(c)}if(o){const d=[];for(let c=s[0];c<=s[1];c+=o)d.push(c);return d}else return s}})}getDpi(t){return a(this,void 0,void 0,function*(){if(yield this.hidpp.getVersion(),this.hidpp.version===1)throw new Error("Not Implemented");{const{index:i}=yield this.hidpp.getFeature(8705),r=yield this.hidpp.request(17,i,2,new Uint8Array([t]).buffer);return new DataView(r).getUint16(1)}})}setDpi(t,i){return a(this,void 0,void 0,function*(){if(yield this.hidpp.getVersion(),this.hidpp.version===1)throw new Error("Not Implemented");{const{index:r}=yield this.hidpp.getFeature(8705),n=new ArrayBuffer(3);let s=new DataView(n);s.setUint8(0,t),s.setUint16(1,i);const o=yield this.hidpp.request(17,r,3,n);return s=new DataView(o),s.getUint16(1)}})}}var g;(function(e){e[e.Discharging=0]="Discharging",e[e.Charging=1]="Charging",e[e.AlmostFull=2]="AlmostFull",e[e.Charged=3]="Charged",e[e.SlowRecharge=4]="SlowRecharge",e[e.InvalidBattery=5]="InvalidBattery",e[e.TerminalError=6]="TerminalError",e[e.OtherError=7]="OtherError"})(g||(g={}));var m;(function(e){e[e.FastCharging=8]="FastCharging",e[e.SlowCharging=16]="SlowCharging",e[e.LevelCritical=32]="LevelCritical",e[e.Charging=128]="Charging"})(m||(m={}));var y;(function(e){e[e.Critical=1]="Critical",e[e.Low=2]="Low",e[e.Good=4]="Good",e[e.Full=8]="Full"})(y||(y={}));class I{constructor(t){this.hidpp=t}getBattery(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(4096),i=yield this.hidpp.request(17,t,0),r=new Uint8Array(i);return{percentage:r[0],nextPercentage:r[1],status:r[2]}})}getBatteryV1(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(4097),i=yield this.hidpp.request(17,t,0),r=new DataView(i);return{voltage:r.getUint16(0),flags:r.getUint8(2)}})}getBatteryV4(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(4100),i=yield this.hidpp.request(17,t,1),r=new DataView(i);return{percentage:r.getUint8(0),level:r.getUint8(1),status:r.getUint8(2)}})}}class _{constructor(t){this.hidpp=t}getFeatureCount(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(1),i=yield this.hidpp.request(17,t,0);return new Uint8Array(i)[0]})}getFeatures(){return E(this,arguments,function*(){const i=yield v(this.getFeatureCount()),{index:r}=yield v(this.hidpp.getFeature(1));for(let n=0;n<=i;n+=1){const s=yield v(this.hidpp.request(17,r,1,new Uint8Array([n]).buffer)),o=new DataView(s);yield yield v(o.getUint16(0))}})}}new TextDecoder;class P{constructor(t=!1){this.list=[],this.blocking=t}wait(){if(!this.blocking&&(this.blocking=!0,this.list.length===0))return Promise.resolve();const t=new w;return this.list.push(t),t.promise}notify(){this.list.length!==0?this.list.pop().resolve():this.blocking=!1}dispose(){for(const t of this.list)t.reject(new Error("The Mutex has been disposed"));this.list.length=0}}const L=!0,N={vendorId:1133};var l;(function(e){e[e.Success=0]="Success",e[e.InvalidCommand=1]="InvalidCommand",e[e.InvalidAddress=2]="InvalidAddress",e[e.InvalidValue=3]="InvalidValue",e[e.ConnectFail=4]="ConnectFail",e[e.TooManyDevices=5]="TooManyDevices",e[e.AlreadyExists=6]="AlreadyExists",e[e.Busy=7]="Busy",e[e.UnknownDevice=8]="UnknownDevice",e[e.ResourceError=9]="ResourceError",e[e.RequestUnavailable=10]="RequestUnavailable",e[e.InvalidParamValue=11]="InvalidParamValue",e[e.WrongPinCode=12]="WrongPinCode"})(l||(l={}));const U={[l.Success]:"No error",[l.InvalidCommand]:"Invalid command",[l.InvalidAddress]:"Invalid address",[l.InvalidValue]:"Invalid value",[l.ConnectFail]:"Connection request failed (Receiver)",[l.TooManyDevices]:"Too many devices connected (Receiver)",[l.AlreadyExists]:"Already exists (Receiver)",[l.Busy]:"Busy (Receiver)",[l.UnknownDevice]:"Unknown device (Receiver)",[l.ResourceError]:"Resource error (Receiver)",[l.RequestUnavailable]:"Request not valid in current context",[l.InvalidParamValue]:"Request parameter has unsupported value",[l.WrongPinCode]:"The PIN code entered on the device was wrong"};function S(...e){let t=0;for(const n of e)n&&(t+=n.byteLength);const i=new Uint8Array(t);let r=0;for(const n of e)n&&(i.set(new Uint8Array(n),r),r+=n.byteLength);return i.buffer}class A{constructor(t,i,r){if(this.disconnectEvent=new x,this.onDisconnect=this.disconnectEvent.event,this._mutex=new P,this._featureIdToIndex={},this.handleInputReport=({data:n})=>{const s=new Uint8Array(n.buffer),o=s[0];{const u=s[1],f=s[2],p=n.buffer.slice(3);console.log(`raw message ${o} 0x${u.toString(16).padStart(2,"0")} 0x${f.toString(16).padStart(2,"0")}`,Array.from(new Uint8Array(p)))}if(o!==this.index)return;const d=this._request;if(!d)return;let c=s[1];if(c===143){c=s[2];const u=s[3];if(d.command===c&&d.address===u){const f=s[4];console.error(`error ${c.toString(16)} ${u.toString(16)} ${U[f]}`);const p=new Error(U[f]);p.name="Hidpp1Error",p.code=f,d.resolver.reject(p),this._request=void 0}return}const h=s[2];if(d.command===c&&d.address===h){const u=n.buffer.slice(3);console.log(`response ${o} 0x${c.toString(16)} 0x${(this.version===2?h>>4:h).toString(16)}`,Array.from(new Uint8Array(u))),d.resolver.resolve(u),this._request=void 0}},this.device=t,this.index=i,this.receiver=r,this.index===255&&this.device.addEventListener("inputreport",this.handleInputReport),this.receiver){this._mutex=this.receiver.hidpp._mutex;const n=this.receiver.onChildDisconnect(s=>{s===this&&(this.disconnectEvent.fire(),n())})}}getVersion(){return a(this,void 0,void 0,function*(){if(this.version)return;if(this.device.opened||(yield this.device.open()),!this.device.collections.some(i=>{var r;return(r=i.outputReports)===null||r===void 0?void 0:r.some(n=>n.reportId===17)}))this.version=1;else{const i=new w,r=0,n=1<<4;this._request={command:r,address:n,resolver:i},yield this.device.sendReport(17,new Uint8Array([this.index,r,n]));try{yield i.promise,this.version=2}catch(s){if(s instanceof Error&&s.name==="Hidpp1Error"&&s.code===l.InvalidCommand)this.version=1;else throw s}}})}getFeature(t){return a(this,void 0,void 0,function*(){if(yield this.getVersion(),this.version===1)throw new Error("Feature not supported in HID++ 1.0");if(this._featureIdToIndex[t])return this._featureIdToIndex[t];const i=new ArrayBuffer(2);new DataView(i).setUint16(0,t);const r=yield this.request(17,0,0,i),n=new Uint8Array(r),s=n[0];if(s===0)throw new Error("Feature not supported");const o=n[2];return this._featureIdToIndex[t]={index:s,version:o},{index:s,version:o}})}request(t,i,r,n){return a(this,void 0,void 0,function*(){if(!this.version)throw new Error("Unknown device version");yield this._mutex.wait();try{this.device.opened||(yield this.device.open()),L&&console.log(`request 0x${i.toString(16)} 0x${r.toString(16)}`,n?Array.from(new Uint8Array(n)):""),this.version===2&&(r=r<<4);const s=new w;return this._request={command:i,address:r,resolver:s},yield this.device.sendReport(t,S(new Uint8Array([this.index,i,r]),n)),yield s.promise}finally{this._mutex.notify()}})}}function b(e){return e.collections.some(t=>t.usagePage===65347||t.usagePage===65280)}function V(){return a(this,void 0,void 0,function*(){const e=yield window.navigator.hid.requestDevice({filters:[N]});if(e.length===0)throw new Error("No device selected");const t=e.find(b);if(!t)throw new Error("Device not recognized");return t})}class k{constructor(t){this.children=[],this.childConnectEvent=new x,this.onChildConnect=this.childConnectEvent.event,this.childDisconnectEvent=new x,this.onChildDisconnect=this.childDisconnectEvent.event,this.handleInputReport=({data:i})=>{var r;const n=new Uint8Array(i.buffer),s=n[0];if(s!==255){if(n[1]===65){(n[3]&1<<6)==0?this.children[s]||this.childConnectEvent.fire(this.getChild(s)):this.children[s]&&(this.childDisconnectEvent.fire(this.getChild(s)),delete this.children[s]);return}(r=this.children[s])===null||r===void 0||r.handleInputReport({data:i})}else{const o=n[1],d=n[2],c=i.buffer.slice(3);console.log(`raw message ${s} 0x${o.toString(16).padStart(2,"0")} 0x${d.toString(16).padStart(2,"0")}`,Array.from(new Uint8Array(c)))}},this.hidpp=t,this.hidpp.device.addEventListener("inputreport",this.handleInputReport)}getChildCount(){return a(this,void 0,void 0,function*(){if(yield this.hidpp.getVersion(),this.hidpp.version!==1)throw new Error("Unsupported version");const t=yield this.hidpp.request(16,129,2);return new Uint8Array(t)[1]})}detectChildren(){return a(this,void 0,void 0,function*(){yield this.hidpp.request(16,128,0,new Uint8Array([0,1,0]).buffer),yield this.hidpp.request(16,128,2,new Uint8Array([2]).buffer)})}getChild(t){return this.children[t]||(this.children[t]=new A(this.hidpp.device,t,this)),this.children[t]}}class M{constructor(t){this.hidpp=t}getReportRateList(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(32864),i=yield this.hidpp.request(17,t,0),n=new Uint8Array(i)[0],s=[];for(let o=0;o<8;o+=1)n&1<<o&&s.push(o+1);return s})}getReportRate(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(32864),i=yield this.hidpp.request(17,t,1);return new Uint8Array(i)[0]})}setReportRate(t){return a(this,void 0,void 0,function*(){const{index:i}=yield this.hidpp.getFeature(32864);yield this.hidpp.request(17,i,2,new Uint8Array([t]))})}}const T=new TextDecoder;var R;(function(e){e[e.Keyboard=0]="Keyboard",e[e.RemoteControl=1]="RemoteControl",e[e.Numpad=2]="Numpad",e[e.Mouse=3]="Mouse",e[e.TouchPad=4]="TouchPad",e[e.Trackball=5]="Trackball",e[e.Presenter=6]="Presenter",e[e.Remote=7]="Remote",e[e.Receiver=8]="Receiver"})(R||(R={}));class O{constructor(t){this.hidpp=t}getNameLength(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(5),i=yield this.hidpp.request(17,t,0);return new Uint8Array(i)[0]})}getName(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(5),i=yield this.getNameLength();let r=new Uint8Array(i);for(let n=0;n<i;n+=16){const s=yield this.hidpp.request(17,t,1,new Uint8Array([n]).buffer);r.set(new Uint8Array(s,0,Math.min(i-n,16)),n)}return T.decode(r)})}getType(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(5),i=yield this.hidpp.request(17,t,2);return new Uint8Array(i)[0]})}}const j=document.getElementById("root"),C=[];async function q(e){if(await e.getVersion(),console.log(e),e.version===1){const i=new k(e);console.log(i),i.onChildConnect(n=>q(n)),await i.detectChildren();const r=await i.getChildCount();console.log("childrenCount",r);return}const t=document.createElement("div");e.onDisconnect(()=>{t.remove()});try{const i=new O(e);let r=document.createElement("div");r.textContent=`${e.index} - ${await i.getName()}`,t.appendChild(r),r=document.createElement("div"),r.textContent=`Type: ${R[await i.getType()]}`,t.appendChild(r)}catch{}try{const i=new _(e),r=document.createElement("div");r.textContent="Features: ";let n=0;for await(const s of i.getFeatures())r.textContent+=`0x${n.toString(16)}=0x${s.toString(16).padStart(4,"0")} `,n+=1;t.appendChild(r)}catch{}try{const i=new I(e),{percentage:r,nextPercentage:n,status:s}=await i.getBattery();console.log("battery",r,n,s);const o=document.createElement("div");o.textContent=`Battery: about ${r}%, ${g[s]}`,t.appendChild(o)}catch{}try{const i=new I(e),{voltage:r,flags:n}=await i.getBatteryV1();console.log("battery",r,n,status);const s=document.createElement("div");s.textContent=`Battery: ${r}mV, ${m[n]}`,t.appendChild(s)}catch{}try{const i=new I(e),{percentage:r,level:n,status:s}=await i.getBatteryV4();console.log("battery",r,n,s);const o=document.createElement("div");o.textContent=`Battery: ${r?`${r}%`:y[n]}, ${g[s]}`,t.appendChild(o)}catch{}try{const i=new $(e),r=await i.getSensorCount();for(let n=0;n<r;n+=1){const s=n,o=await i.getDpiList(s),d=await i.getDpi(s),c=document.createElement("div");c.textContent=`Sensor ${s} DPI: `;const h=document.createElement("select");for(const u of o){const f=document.createElement("option");f.value=u.toString(),f.innerText=u.toString(),h.appendChild(f)}h.value=d.toString(),h.onchange=async()=>{console.log(h.value),await i.setDpi(s,parseInt(h.value,10))},c.appendChild(h),t.appendChild(c)}}catch{}try{const i=new M(e),r=await i.getReportRateList(),n=await i.getReportRate(),s=document.createElement("div");s.textContent="Report Rate: ";const o=document.createElement("select");for(const d of r){const c=document.createElement("option");c.value=d.toString(),c.innerText=`${d}ms`,o.appendChild(c)}o.value=n.toString(),o.onchange=async()=>{console.log(o.value),await i.setReportRate(parseInt(o.value,10))},s.appendChild(o),t.appendChild(s)}catch{}j.appendChild(t)}async function F(e){C.includes(e)||(C.push(e),console.log(e),await q(new A(e,255)))}(async()=>{const e=await navigator.hid.getDevices();for(const t of e)b(t)&&await F(t)})();document.getElementById("select-button").onclick=async()=>{const e=await V();C.includes(e)||(console.log(e),await F(e))};
