import{_ as l,P as p}from"./vendor.9d5ac3d8.js";const I=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerpolicy&&(s.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?s.credentials="include":t.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(t){if(t.ep)return;t.ep=!0;const s=r(t);fetch(t.href,s)}};I();class R{constructor(e){this.hidpp=e}getDpiList(){return l(this,void 0,void 0,function*(){if(yield this.hidpp.getVersion(),this.hidpp.version===1)throw new Error("Not Implemented");{const e=yield this.hidpp.getFeatureIndex(8705),r=yield this.hidpp.request(17,e,1),i=new DataView(r);let t=[],s;for(let o=1;o<=1+14;o+=2){const c=i.getUint16(o);if(c===0)break;if(c>>13==7){s=c&8191;continue}t.push(c)}if(s){const o=[];for(let c=t[0];c<=t[1];c+=s)o.push(c);return o}else return t}})}getDpi(){return l(this,void 0,void 0,function*(){if(yield this.hidpp.getVersion(),this.hidpp.version===1)throw new Error("Not Implemented");{const e=yield this.hidpp.getFeatureIndex(8705),r=yield this.hidpp.request(17,e,2);return new DataView(r).getUint16(1)}})}setDpi(e){return l(this,void 0,void 0,function*(){if(yield this.hidpp.getVersion(),this.hidpp.version===1)throw new Error("Not Implemented");{const r=yield this.hidpp.getFeatureIndex(8705),i=new ArrayBuffer(3);let t=new DataView(i);t.setUint16(1,e);const s=yield this.hidpp.request(17,r,3,i);return t=new DataView(s),t.getUint16(1)}})}}new TextDecoder;class D{constructor(e=!1){this.list=[],this.blocking=e}wait(){if(!this.blocking&&(this.blocking=!0,this.list.length===0))return Promise.resolve();const e=new p;return this.list.push(e),e.promise}notify(){this.list.length!==0?this.list.pop().resolve():this.blocking=!1}dispose(){for(const e of this.list)e.reject(new Error("The Mutex has been disposed"));this.list.length=0}}const A=!0,U={vendorId:1133};var a;(function(n){n[n.Success=0]="Success",n[n.InvalidCommand=1]="InvalidCommand",n[n.InvalidAddress=2]="InvalidAddress",n[n.InvalidValue=3]="InvalidValue",n[n.ConnectFail=4]="ConnectFail",n[n.TooManyDevices=5]="TooManyDevices",n[n.AlreadyExists=6]="AlreadyExists",n[n.Busy=7]="Busy",n[n.UnknownDevice=8]="UnknownDevice",n[n.ResourceError=9]="ResourceError",n[n.RequestUnavailable=10]="RequestUnavailable",n[n.InvalidParamValue=11]="InvalidParamValue",n[n.WrongPinCode=12]="WrongPinCode"})(a||(a={}));const q={[a.Success]:"No error",[a.InvalidCommand]:"Invalid command",[a.InvalidAddress]:"Invalid address",[a.InvalidValue]:"Invalid value",[a.ConnectFail]:"Connection request failed (Receiver)",[a.TooManyDevices]:"Too many devices connected (Receiver)",[a.AlreadyExists]:"Already exists (Receiver)",[a.Busy]:"Busy (Receiver)",[a.UnknownDevice]:"Unknown device (Receiver)",[a.ResourceError]:"Resource error (Receiver)",[a.RequestUnavailable]:"Request not valid in current context",[a.InvalidParamValue]:"Request parameter has unsupported value",[a.WrongPinCode]:"The PIN code entered on the device was wrong"};function b(...n){let e=0;for(const t of n)t&&(e+=t.byteLength);const r=new Uint8Array(e);let i=0;for(const t of n)t&&(r.set(new Uint8Array(t),i),i+=t.byteLength);return r.buffer}class y{constructor(e,r,i){this._mutex=new D,this._featureIdToIndex={},this.handleInputReport=({data:t})=>{const s=new Uint8Array(t.buffer);if(s[0]!==this.index)return;const c=this._request;if(!c)return;let u=s[1];if(u===143){u=s[2];const d=s[3];if(c.command===u&&c.address===d){const f=s[4];console.error("error",u.toString(16),d.toString(16),f);const v=new Error(q[f]);v.name="Hidpp1Error",v.code=f,c.resolver.reject(v),this._request=void 0}return}const h=s[2];if(c.command===u&&c.address===h){const d=t.buffer.slice(3);console.log("response",u.toString(16),(this.version===2?h>>4:h).toString(16),Array.from(new Uint8Array(d))),c.resolver.resolve(d),this._request=void 0}},this.device=e,this.index=r,this.receiver=i,this.index===255&&this.device.addEventListener("inputreport",this.handleInputReport),this.receiver&&(this._mutex=this.receiver._mutex)}getVersion(){return l(this,void 0,void 0,function*(){if(this.version)return;if(this.device.opened||(yield this.device.open()),!this.device.collections.some(r=>{var i;return(i=r.outputReports)===null||i===void 0?void 0:i.some(t=>t.reportId===17)}))this.version=1;else{const r=new p,i=0,t=1<<4;this._request={command:i,address:t,resolver:r},yield this.device.sendReport(17,new Uint8Array([this.index,i,t]));try{yield r.promise,this.version=2}catch(s){if(s instanceof Error&&s.name==="Hidpp1Error"&&s.code===a.InvalidCommand)this.version=1;else throw s}}})}getFeatureIndex(e){return l(this,void 0,void 0,function*(){if(yield this.getVersion(),this.version===1)throw new Error("Feature not supported in HID++ 1.0");if(this._featureIdToIndex[e])return this._featureIdToIndex[e];const r=new ArrayBuffer(2);new DataView(r).setUint16(0,e);const t=yield this.request(17,0,0,r),s=new Uint8Array(t)[0];if(s===0)throw new Error("Feature not supported");return this._featureIdToIndex[e]=s,s})}request(e,r,i,t){return l(this,void 0,void 0,function*(){if(!this.version)throw new Error("Unknown device version");yield this._mutex.wait();try{this.device.opened||(yield this.device.open()),A&&console.log("request",r.toString(16),i.toString(16),t?Array.from(new Uint8Array(t)):""),this.version===2&&(i=i<<4);const s=new p;return this._request={command:r,address:i,resolver:s},yield this.device.sendReport(e,b(new Uint8Array([this.index,r,i]),t)),yield s.promise}finally{this._mutex.notify()}})}}function x(n){return n.collections.some(e=>e.usagePage===65347||e.usagePage===65280)}function L(){return l(this,void 0,void 0,function*(){const n=yield window.navigator.hid.requestDevice({filters:[U]});if(n.length===0)throw new Error("No device selected");const e=n.find(x);if(!e)throw new Error("Device not recognized");return e})}class _{constructor(e){this.children=[],this.handleInputReport=({data:r})=>{var i;const s=new Uint8Array(r.buffer)[0];s!==255&&((i=this.children[s])===null||i===void 0||i.handleInputReport({data:r}))},this.hidpp=e,this.hidpp.device.addEventListener("inputreport",this.handleInputReport)}getChildIndices(){return l(this,void 0,void 0,function*(){if(yield this.hidpp.getVersion(),this.hidpp.version!==1)throw new Error("Unsupported version");const e=yield this.hidpp.request(16,129,2),r=new Uint8Array(e)[1],i=[];for(let t=0;t<8;t++)r&1<<t&&i.push(t+1);return i})}getChild(e){return this.children[e]||(this.children[e]=new y(this.hidpp.device,e,this.hidpp)),this.children[e]}}class V{constructor(e){this.hidpp=e}getReportRateList(){return l(this,void 0,void 0,function*(){const e=yield this.hidpp.getFeatureIndex(32864),r=yield this.hidpp.request(17,e,0),t=new Uint8Array(r)[0],s=[];for(let o=0;o<8;o+=1)t&1<<o&&s.push(o+1);return s})}getReportRate(){return l(this,void 0,void 0,function*(){const e=yield this.hidpp.getFeatureIndex(32864),r=yield this.hidpp.request(17,e,1);return new Uint8Array(r)[0]})}setReportRate(e){return l(this,void 0,void 0,function*(){const r=yield this.hidpp.getFeatureIndex(32864);yield this.hidpp.request(17,r,2,new Uint8Array([e]))})}}const F=new TextDecoder;class T{constructor(e){this.hidpp=e}getDeviceNameLength(){return l(this,void 0,void 0,function*(){const e=yield this.hidpp.getFeatureIndex(5),r=yield this.hidpp.request(17,e,0);return new Uint8Array(r)[0]})}getDeviceName(){return l(this,void 0,void 0,function*(){const e=yield this.hidpp.getFeatureIndex(5),r=yield this.getDeviceNameLength();let i=new Uint8Array(r);for(let t=0;t<r;t+=16){const s=yield this.hidpp.request(17,e,1,new Uint8Array([t]).buffer);i.set(new Uint8Array(s,0,Math.min(r-t,16)),t)}return F.decode(i)})}}const w=document.getElementById("settings"),g=[];async function m(n){if(g.includes(n))return;g.push(n),console.log(n);const e=new y(n,255);await e.getVersion(),console.log(e);const r=[];if(e.version===1){const i=new _(e),t=await i.getChildIndices();console.log(t);for(const s of t){const o=i.getChild(s);r.push(o)}}else r.push(e);for(const i of r){console.log(i);const t=document.createElement("div"),s=new T(i);t.textContent=await s.getDeviceName(),w.appendChild(t);try{const o=new R(i),c=await o.getDpiList();console.log(c);const u=await o.getDpi();console.log(u);const h=document.createElement("div");h.textContent="DPI: ";const d=document.createElement("select");for(const f of c){const v=document.createElement("option");v.value=f.toString(),v.innerText=f.toString(),d.appendChild(v)}d.value=u.toString(),d.onchange=async()=>{console.log(d.value),await o.setDpi(parseInt(d.value,10))},h.appendChild(d),w.appendChild(h)}catch{}try{const o=new V(i),c=await o.getReportRateList(),u=await o.getReportRate(),h=document.createElement("div");h.textContent="Report Rate: ";const d=document.createElement("select");for(const f of c){const v=document.createElement("option");v.value=f.toString(),v.innerText=`${f}ms`,d.appendChild(v)}d.value=u.toString(),d.onchange=async()=>{console.log(d.value),await o.setReportRate(parseInt(d.value,10))},h.appendChild(d),w.appendChild(h)}catch(o){console.error(o)}}}(async()=>{const n=await navigator.hid.getDevices();for(const e of n)x(e)&&await m(e)})();document.getElementById("select-button").onclick=async()=>{const n=await L();g.includes(n)||(console.log(n),await m(n))};
