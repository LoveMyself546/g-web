import{_ as d,a as S,b as p,P as m,E as y}from"./vendor.241a3de2.js";const $=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}};$();class q{constructor(t){this.hidpp=t}getSensorCount(){return d(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(8705),r=yield this.hidpp.request(17,t,0);return new Uint8Array(r)[0]})}getDpiList(t){return d(this,void 0,void 0,function*(){if(yield this.hidpp.getVersion(),this.hidpp.version===1)throw new Error("Not Implemented");{const{index:r}=yield this.hidpp.getFeature(8705),o=yield this.hidpp.request(17,r,1,new Uint8Array([t]).buffer),n=new DataView(o);let i=[],s;for(let a=1;a<=1+14;a+=2){const c=n.getUint16(a);if(c===0)break;if(c>>13==7){s=c&8191;continue}i.push(c)}if(s){const a=[];for(let c=i[0];c<=i[1];c+=s)a.push(c);return a}else return i}})}getDpi(t){return d(this,void 0,void 0,function*(){if(yield this.hidpp.getVersion(),this.hidpp.version===1)throw new Error("Not Implemented");{const{index:r}=yield this.hidpp.getFeature(8705),o=yield this.hidpp.request(17,r,2,new Uint8Array([t]).buffer);return new DataView(o).getUint16(1)}})}setDpi(t,r){return d(this,void 0,void 0,function*(){if(yield this.hidpp.getVersion(),this.hidpp.version===1)throw new Error("Not Implemented");{const{index:o}=yield this.hidpp.getFeature(8705),n=new ArrayBuffer(3);let i=new DataView(n);i.setUint8(0,t),i.setUint16(1,r);const s=yield this.hidpp.request(17,o,3,n);return i=new DataView(s),i.getUint16(1)}})}}var g;(function(e){e[e.Discharging=0]="Discharging",e[e.Charging=1]="Charging",e[e.AlmostFull=2]="AlmostFull",e[e.Charged=3]="Charged",e[e.SlowRecharge=4]="SlowRecharge",e[e.InvalidBattery=5]="InvalidBattery",e[e.TerminalError=6]="TerminalError",e[e.OtherError=7]="OtherError"})(g||(g={}));var b;(function(e){e[e.FastCharging=8]="FastCharging",e[e.SlowCharging=16]="SlowCharging",e[e.LevelCritical=32]="LevelCritical",e[e.Charging=128]="Charging"})(b||(b={}));var C;(function(e){e[e.Critical=1]="Critical",e[e.Low=2]="Low",e[e.Good=4]="Good",e[e.Full=8]="Full"})(C||(C={}));class I{constructor(t){this.hidpp=t}getBattery(){return d(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(4096),r=yield this.hidpp.request(17,t,0),o=new Uint8Array(r);return{percentage:o[0],nextPercentage:o[1],status:o[2]}})}getBatteryV1(){return d(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(4097),r=yield this.hidpp.request(17,t,0),o=new DataView(r);return{voltage:o.getUint16(0),flags:o.getUint8(2)}})}getBatteryV4(){return d(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(4100),r=yield this.hidpp.request(17,t,1),o=new DataView(r);return{percentage:o.getUint8(0),level:o.getUint8(1),status:o.getUint8(2)}})}}class L{constructor(t){this.hidpp=t}getFeatureCount(){return d(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(1),r=yield this.hidpp.request(17,t,0);return new Uint8Array(r)[0]})}getFeatures(){return S(this,arguments,function*(){const r=yield p(this.getFeatureCount()),{index:o}=yield p(this.hidpp.getFeature(1));for(let n=0;n<=r;n+=1){const i=yield p(this.hidpp.request(17,o,1,new Uint8Array([n]).buffer)),s=new DataView(i),a=s.getUint16(0),c=s.getUint8(2);yield yield p({id:a,obsolete:(c&1<<7)!=0,hidden:(c&1<<6)!=0,internal:(c&1<<5)!=0})}})}}const _=new TextDecoder;var v;(function(e){e[e.Firmware=0]="Firmware",e[e.Bootloader=1]="Bootloader",e[e.Hardware=2]="Hardware",e[e.Other=3]="Other"})(v||(v={}));class T{constructor(t){this.hidpp=t}getFirmwareCount(){return d(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(3),r=yield this.hidpp.request(17,t,0);return new Uint8Array(r)[0]})}getFirmwareVersion(t){return d(this,void 0,void 0,function*(){const{index:r}=yield this.hidpp.getFeature(3),o=yield this.hidpp.request(17,r,1,new Uint8Array([t]).buffer),n=new DataView(o),i=n.getUint8(0)&15;switch(i){case v.Firmware:case v.Bootloader:{const s=_.decode(o.slice(1,4)),a=n.getUint8(4),c=n.getUint8(5),x=n.getUint16(6);return{type:i,name:s,major:a,minor:c,build:x}}case v.Hardware:return{type:i,name:"",major:n.getUint8(1),minor:0,build:0};default:return{type:i,name:"",major:0,minor:0,build:0}}})}}new TextDecoder;class k{constructor(t=!1){this.list=[],this.blocking=t}wait(){if(!this.blocking&&(this.blocking=!0,this.list.length===0))return Promise.resolve();const t=new m;return this.list.push(t),t.promise}notify(){this.list.length!==0?this.list.pop().resolve():this.blocking=!1}dispose(){for(const t of this.list)t.reject(new Error("The Mutex has been disposed"));this.list.length=0}}const N=!0,M={vendorId:1133};var h;(function(e){e[e.Success=0]="Success",e[e.InvalidCommand=1]="InvalidCommand",e[e.InvalidAddress=2]="InvalidAddress",e[e.InvalidValue=3]="InvalidValue",e[e.ConnectFail=4]="ConnectFail",e[e.TooManyDevices=5]="TooManyDevices",e[e.AlreadyExists=6]="AlreadyExists",e[e.Busy=7]="Busy",e[e.UnknownDevice=8]="UnknownDevice",e[e.ResourceError=9]="ResourceError",e[e.RequestUnavailable=10]="RequestUnavailable",e[e.InvalidParamValue=11]="InvalidParamValue",e[e.WrongPinCode=12]="WrongPinCode"})(h||(h={}));const A={[h.Success]:"No error",[h.InvalidCommand]:"Invalid command",[h.InvalidAddress]:"Invalid address",[h.InvalidValue]:"Invalid value",[h.ConnectFail]:"Connection request failed (Receiver)",[h.TooManyDevices]:"Too many devices connected (Receiver)",[h.AlreadyExists]:"Already exists (Receiver)",[h.Busy]:"Busy (Receiver)",[h.UnknownDevice]:"Unknown device (Receiver)",[h.ResourceError]:"Resource error (Receiver)",[h.RequestUnavailable]:"Request not valid in current context",[h.InvalidParamValue]:"Request parameter has unsupported value",[h.WrongPinCode]:"The PIN code entered on the device was wrong"};function V(...e){let t=0;for(const n of e)n&&(t+=n.byteLength);const r=new Uint8Array(t);let o=0;for(const n of e)n&&(r.set(new Uint8Array(n),o),o+=n.byteLength);return r.buffer}class F{constructor(t,r,o){if(this.disconnectEvent=new y,this.onDisconnect=this.disconnectEvent.event,this._mutex=new k,this._featureIdToIndex={},this.handleInputReport=({data:n})=>{const i=new Uint8Array(n.buffer),s=i[0];{const l=i[1],u=i[2],f=n.buffer.slice(3);console.log(`raw message ${s} 0x${l.toString(16).padStart(2,"0")} 0x${u.toString(16).padStart(2,"0")}`,Array.from(new Uint8Array(f)))}if(s!==this.index)return;const a=this._request;if(!a)return;let c=i[1];if(c===143){c=i[2];const l=i[3];if(a.command===c&&a.address===l){const u=i[4];console.error(`error ${c.toString(16)} ${l.toString(16)} ${A[u]}`);const f=new Error(A[u]);f.name="Hidpp1Error",f.code=u,a.resolver.reject(f),this._request=void 0}return}const x=i[2];if(a.command===c&&a.address===x){const l=n.buffer.slice(3);console.log(`response ${s} 0x${c.toString(16)} 0x${(this.version===2?x>>4:x).toString(16)}`,Array.from(new Uint8Array(l))),a.resolver.resolve(l),this._request=void 0}},this.device=t,this.index=r,this.receiver=o,this.index===255&&this.device.addEventListener("inputreport",this.handleInputReport),this.receiver){this._mutex=this.receiver.hidpp._mutex;const n=this.receiver.onChildDisconnect(i=>{i===this&&(this.disconnectEvent.fire(),n())})}}getVersion(){return d(this,void 0,void 0,function*(){if(this.version)return;if(this.device.opened||(yield this.device.open()),!this.device.collections.some(r=>{var o;return(o=r.outputReports)===null||o===void 0?void 0:o.some(n=>n.reportId===17)}))this.version=1;else{const r=new m,o=0,n=1<<4;this._request={command:o,address:n,resolver:r},yield this.device.sendReport(17,new Uint8Array([this.index,o,n]));try{yield r.promise,this.version=2}catch(i){if(i instanceof Error&&i.name==="Hidpp1Error"&&i.code===h.InvalidCommand)this.version=1;else throw i}}})}getFeature(t){return d(this,void 0,void 0,function*(){if(yield this.getVersion(),this.version===1)throw new Error("Feature not supported in HID++ 1.0");if(this._featureIdToIndex[t])return this._featureIdToIndex[t];const r=new ArrayBuffer(2);new DataView(r).setUint16(0,t);const o=yield this.request(17,0,0,r),n=new Uint8Array(o),i=n[0];if(i===0)throw new Error("Feature not supported");const s=n[2];return this._featureIdToIndex[t]={index:i,version:s},{index:i,version:s}})}request(t,r,o,n){return d(this,void 0,void 0,function*(){if(!this.version)throw new Error("Unknown device version");yield this._mutex.wait();try{this.device.opened||(yield this.device.open()),N&&console.log(`request 0x${r.toString(16)} 0x${o.toString(16)}`,n?Array.from(new Uint8Array(n)):""),this.version===2&&(o=o<<4);const i=new m;return this._request={command:r,address:o,resolver:i},yield this.device.sendReport(t,V(new Uint8Array([this.index,r,o]),n)),yield i.promise}finally{this._mutex.notify()}})}}function D(e){return e.collections.some(t=>t.usagePage===65347||t.usagePage===65280)}function K(){return d(this,void 0,void 0,function*(){const e=yield window.navigator.hid.requestDevice({filters:[M]});if(e.length===0)throw new Error("No device selected");const t=e.find(D);if(!t)throw new Error("Device not recognized");return t})}class B{constructor(t){this.children=[],this.childConnectEvent=new y,this.onChildConnect=this.childConnectEvent.event,this.childDisconnectEvent=new y,this.onChildDisconnect=this.childDisconnectEvent.event,this.handleInputReport=({data:r})=>{var o;const n=new Uint8Array(r.buffer),i=n[0];if(i!==255){if(n[1]===65){(n[3]&1<<6)==0?this.children[i]||this.childConnectEvent.fire(this.getChild(i)):this.children[i]&&(this.childDisconnectEvent.fire(this.getChild(i)),delete this.children[i]);return}(o=this.children[i])===null||o===void 0||o.handleInputReport({data:r})}else{const s=n[1],a=n[2],c=r.buffer.slice(3);console.log(`raw message ${i} 0x${s.toString(16).padStart(2,"0")} 0x${a.toString(16).padStart(2,"0")}`,Array.from(new Uint8Array(c)))}},this.hidpp=t,this.hidpp.device.addEventListener("inputreport",this.handleInputReport)}getChildCount(){return d(this,void 0,void 0,function*(){if(yield this.hidpp.getVersion(),this.hidpp.version!==1)throw new Error("Unsupported version");const t=yield this.hidpp.request(16,129,2);return new Uint8Array(t)[1]})}detectChildren(){return d(this,void 0,void 0,function*(){yield this.hidpp.request(16,128,0,new Uint8Array([0,1,0]).buffer),yield this.hidpp.request(16,128,2,new Uint8Array([2]).buffer)})}getChild(t){return this.children[t]||(this.children[t]=new F(this.hidpp.device,t,this)),this.children[t]}}class O{constructor(t){this.hidpp=t}getReportRateList(){return d(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(32864),r=yield this.hidpp.request(17,t,0),n=new Uint8Array(r)[0],i=[];for(let s=0;s<8;s+=1)n&1<<s&&i.push(s+1);return i})}getReportRate(){return d(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(32864),r=yield this.hidpp.request(17,t,1);return new Uint8Array(r)[0]})}setReportRate(t){return d(this,void 0,void 0,function*(){const{index:r}=yield this.hidpp.getFeature(32864);yield this.hidpp.request(17,r,2,new Uint8Array([t]))})}}const j=new TextDecoder;var R;(function(e){e[e.Keyboard=0]="Keyboard",e[e.RemoteControl=1]="RemoteControl",e[e.Numpad=2]="Numpad",e[e.Mouse=3]="Mouse",e[e.TouchPad=4]="TouchPad",e[e.Trackball=5]="Trackball",e[e.Presenter=6]="Presenter",e[e.Remote=7]="Remote",e[e.Receiver=8]="Receiver"})(R||(R={}));class W{constructor(t){this.hidpp=t}getNameLength(){return d(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(5),r=yield this.hidpp.request(17,t,0);return new Uint8Array(r)[0]})}getName(){return d(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(5),r=yield this.getNameLength();let o=new Uint8Array(r);for(let n=0;n<r;n+=16){const i=yield this.hidpp.request(17,t,1,new Uint8Array([n]).buffer);o.set(new Uint8Array(i,0,Math.min(r-n,16)),n)}return j.decode(o)})}getType(){return d(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(5),r=yield this.hidpp.request(17,t,2);return new Uint8Array(r)[0]})}}const G=document.getElementById("root"),U=[];async function E(e){var r,o;if(await e.getVersion(),console.log(e),e.version===1){const n=new B(e);console.log(n),n.onChildConnect(s=>E(s)),await n.detectChildren();const i=await n.getChildCount();console.log("childrenCount",i);return}const t=document.createElement("div");e.onDisconnect(()=>{t.remove()});try{const n=new W(e);let i=document.createElement("div");i.textContent=`${e.index} - ${await n.getName()}`,t.appendChild(i),i=document.createElement("div"),i.textContent=`Type: ${R[await n.getType()]}`,t.appendChild(i)}catch{}try{const n=new L(e),i=document.createElement("div");i.textContent="Features: ";let s=0;for await(const a of n.getFeatures()){const c=`0x${a.id.toString(16).padStart(4,"0")}`,x=document.createElement("div"),l={"0x0000":"Root","0x0001":"Feature Set","0x0002":"Feature Info","0x0003":"Firmware Info","0x0004":"Device Unit ID","0x0005":"Device Name","0x0006":"Device Groups","0x0007":"Device Friendly Name","0x0008":"Keep Alive","0x0020":"Config Change","0x0021":"Crypto ID","0x0040":"Target Software","0x0080":"Wireless Signal Strength","0x00c0":"DFU Control v0","0x00c1":"DFU Control v1","0x00c2":"DFU Control v2","0x00d0":"DFU","0x1000":"Battery v0","0x1001":"Battery v1","0x1004":"Battery v4","0x1010":"Charging Control","0x1300":"LED Control","0x1800":"Generic Test","0x1802":"Device Reset","0x1805":"OOB State","0x1806":"Configurable Device Properties","0x1014":"Change Host","0x1015":"Hosts Info","0x1981":"Keyboard Backlight v1","0x1982":"Keyboard Backlight v2","0x1983":"Keyboard Backlight v3","0x1a00":"Presenter Control","0x1b00":"Reprogrammable Control v0","0x1b01":"Reprogrammable Control v1","0x1b02":"Reprogrammable Control v2","0x1b03":"Reprogrammable Control v3","0x1b04":"Reprogrammable Control v4","0x1bc0":"Report HID Usages","0x1c00":"Persistent Remappable Action","0x1d4b":"Wireless Status","0x1df0":"Remaining Pairing","0x1e00":"Enable Hidden Features","0x1f1f":"Firmware Properties","0x0f20":"ADC Measurement","0x2001":"Button Swap","0x2005":"Button Swap Cancel","0x2006":"Pointer Axis Orientation","0x2100":"Vertical Scrolling","0x2110":"Smart Shift v0","0x2111":"Smart Shift v1","0x2120":"Hi-Res Wheel v0","0x2121":"Hi-Res Wheel v1","0x2130":"Ratchet Wheel","0x2150":"Thumb Wheel","0x2200":"Mouse Pointer","0x2201":"Adjustable DPI","0x2205":"Pointer Motion Scaling","0x2230":"Angle Snapping","0x2240":"Surface Tuning","0x2250":"XY Stats","0x2251":"Wheel Stats","0x2400":"Hybrid Tracking","0x40a0":"Fn Inversion v0","0x40a2":"Fn Inversion v2","0x40a3":"Fn Inversion v3","0x4100":"Encryption","0x4220":"Lock Key State","0x4301":"Solar Dashboard","0x4520":"Keyboard Layout","0x4521":"Disable Keys","0x4522":"Disable Keys By Usage","0x4530":"Dual Platform","0x4531":"Multi Platform","0x4540":"Keyboard Layout 2","0x4600":"Crown","0x6010":"TouchPad Firmware Items","0x6011":"TouchPad Software Items","0x6012":"TouchPad Windows 8 Firmware Items","0x6020":"Tap Enabled v0","0x6021":"Tap Enabled v1","0x6030":"Cursor Ballistic","0x6040":"TouchPad Resolution","0x6100":"TouchPad Raw XY","0x6110":"Touch Mouse Raw Points","0x6500":"TouchPad Gestures v0","0x6501":"TouchPad Gestures v1","0x8040":"Brightness Control","0x8060":"Adjustable Report Rate","0x8070":"Color LED Effects","0x8071":"RGB Effects","0x8080":"Per Key Lighting v0","0x8081":"Per Key Lighting v1","0x8090":"Mode Status","0x8100":"On-board Profiles","0x8110":"Mouse Button Spy","0x8111":"Latency Monitoring","0x8120":"Gaming Attachments","0x8123":"Force Feedback","0x8300":"Side Tone","0x8310":"Equalizer","0x8320":"Headset Out"},u=[];a.obsolete&&u.push("obsolete"),a.hidden&&u.push("hidden"),a.internal&&u.push("internal"),x.textContent=`Feature 0x${s.toString(16)}: ${c}${l[c]?` ${l[c]}`:""}${u.length?` (${u.join(", ")})`:""}`,t.appendChild(x),s+=1}}catch{}try{const n=new T(e),i=await n.getFirmwareCount();for(let s=0;s<i;s+=1){const a=await n.getFirmwareVersion(s),c=document.createElement("div");c.textContent=`Firmware ${s}: ${(r=v[a.type])!=null?r:"Unknown"}${a.name?` ${a.name}`:""} ${a.major.toString(16)}.${a.minor.toString(16)}.${a.build.toString(16)}`,t.appendChild(c)}}catch{}try{const n=new I(e),{percentage:i,nextPercentage:s,status:a}=await n.getBattery();console.log("battery",i,s,a);const c=document.createElement("div");c.textContent=`Battery: about ${i}%, ${g[a]}`,t.appendChild(c)}catch{}try{const n=new I(e),{voltage:i,flags:s}=await n.getBatteryV1();console.log("battery",i,s,status);const a=document.createElement("div");a.textContent=`Battery: ${i}mV, ${(o=b[s])!=null?o:"Discharging"}`,t.appendChild(a)}catch{}try{const n=new I(e),{percentage:i,level:s,status:a}=await n.getBatteryV4();console.log("battery",i,s,a);const c=document.createElement("div");c.textContent=`Battery: ${i?`${i}%`:C[s]}, ${g[a]}`,t.appendChild(c)}catch{}try{const n=new q(e),i=await n.getSensorCount();for(let s=0;s<i;s+=1){const a=s,c=await n.getDpiList(a),x=await n.getDpi(a),l=document.createElement("div");l.textContent=`Sensor ${a} DPI: `;const u=document.createElement("select");for(const f of c){const w=document.createElement("option");w.value=f.toString(),w.innerText=f.toString(),u.appendChild(w)}u.value=x.toString(),u.onchange=async()=>{console.log(u.value),await n.setDpi(a,parseInt(u.value,10))},l.appendChild(u),t.appendChild(l)}}catch{}try{const n=new O(e),i=await n.getReportRateList(),s=await n.getReportRate(),a=document.createElement("div");a.textContent="Report Rate: ";const c=document.createElement("select");for(const x of i){const l=document.createElement("option");l.value=x.toString(),l.innerText=`${x}ms`,c.appendChild(l)}c.value=s.toString(),c.onchange=async()=>{console.log(c.value),await n.setReportRate(parseInt(c.value,10))},a.appendChild(c),t.appendChild(a)}catch{}G.appendChild(t)}async function P(e){U.includes(e)||(U.push(e),console.log(e),await E(new F(e,255)))}(async()=>{const e=await navigator.hid.getDevices();for(const t of e)D(t)&&await P(t)})();document.getElementById("select-button").onclick=async()=>{const e=await K();U.includes(e)||(console.log(e),await P(e))};
