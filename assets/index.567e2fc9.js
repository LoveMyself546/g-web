import{_ as a,a as q,b as v,P as w,E}from"./vendor.241a3de2.js";const $=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}};$();class _{constructor(t){this.hidpp=t}getSensorCount(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(8705),n=yield this.hidpp.request(17,t,0);return new Uint8Array(n)[0]})}getDpiList(t){return a(this,void 0,void 0,function*(){if(yield this.hidpp.getVersion(),this.hidpp.version===1)throw new Error("Not Implemented");{const{index:n}=yield this.hidpp.getFeature(8705),i=yield this.hidpp.request(17,n,1,new Uint8Array([t]).buffer),r=new DataView(i);let o=[],s;for(let d=1;d<=1+14;d+=2){const c=r.getUint16(d);if(c===0)break;if(c>>13==7){s=c&8191;continue}o.push(c)}if(s){const d=[];for(let c=o[0];c<=o[1];c+=s)d.push(c);return d}else return o}})}getDpi(t){return a(this,void 0,void 0,function*(){if(yield this.hidpp.getVersion(),this.hidpp.version===1)throw new Error("Not Implemented");{const{index:n}=yield this.hidpp.getFeature(8705),i=yield this.hidpp.request(17,n,2,new Uint8Array([t]).buffer);return new DataView(i).getUint16(1)}})}setDpi(t,n){return a(this,void 0,void 0,function*(){if(yield this.hidpp.getVersion(),this.hidpp.version===1)throw new Error("Not Implemented");{const{index:i}=yield this.hidpp.getFeature(8705),r=new ArrayBuffer(3);let o=new DataView(r);o.setUint8(0,t),o.setUint16(1,n);const s=yield this.hidpp.request(17,i,3,r);return o=new DataView(s),o.getUint16(1)}})}}var g;(function(e){e[e.Discharging=0]="Discharging",e[e.Charging=1]="Charging",e[e.AlmostFull=2]="AlmostFull",e[e.Charged=3]="Charged",e[e.SlowRecharge=4]="SlowRecharge",e[e.InvalidBattery=5]="InvalidBattery",e[e.TerminalError=6]="TerminalError",e[e.OtherError=7]="OtherError"})(g||(g={}));var x;(function(e){e[e.FastCharging=8]="FastCharging",e[e.SlowCharging=16]="SlowCharging",e[e.LevelCritical=32]="LevelCritical",e[e.Charging=128]="Charging"})(x||(x={}));var m;(function(e){e[e.Critical=1]="Critical",e[e.Low=2]="Low",e[e.Good=4]="Good",e[e.Full=8]="Full"})(m||(m={}));class y{constructor(t){this.hidpp=t}getBattery(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(4096),n=yield this.hidpp.request(17,t,0),i=new Uint8Array(n);return{percentage:i[0],nextPercentage:i[1],status:i[2]}})}getBatteryV1(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(4097),n=yield this.hidpp.request(17,t,0),i=new DataView(n);return{voltage:i.getUint16(0),flags:i.getUint8(2)}})}getBatteryV4(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(4100),n=yield this.hidpp.request(17,t,1),i=new DataView(n);return{percentage:i.getUint8(0),level:i.getUint8(1),status:i.getUint8(2)}})}}class D{constructor(t){this.hidpp=t}getFeatureCount(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(1),n=yield this.hidpp.request(17,t,0);return new Uint8Array(n)[0]})}getFeatures(){return q(this,arguments,function*(){const n=yield v(this.getFeatureCount()),{index:i}=yield v(this.hidpp.getFeature(1));for(let r=0;r<=n;r+=1){const o=yield v(this.hidpp.request(17,i,1,new Uint8Array([r]).buffer)),s=new DataView(o);yield yield v(s.getUint16(0))}})}}new TextDecoder;class P{constructor(t=!1){this.list=[],this.blocking=t}wait(){if(!this.blocking&&(this.blocking=!0,this.list.length===0))return Promise.resolve();const t=new w;return this.list.push(t),t.promise}notify(){this.list.length!==0?this.list.pop().resolve():this.blocking=!1}dispose(){for(const t of this.list)t.reject(new Error("The Mutex has been disposed"));this.list.length=0}}const L=!0,N={vendorId:1133};var l;(function(e){e[e.Success=0]="Success",e[e.InvalidCommand=1]="InvalidCommand",e[e.InvalidAddress=2]="InvalidAddress",e[e.InvalidValue=3]="InvalidValue",e[e.ConnectFail=4]="ConnectFail",e[e.TooManyDevices=5]="TooManyDevices",e[e.AlreadyExists=6]="AlreadyExists",e[e.Busy=7]="Busy",e[e.UnknownDevice=8]="UnknownDevice",e[e.ResourceError=9]="ResourceError",e[e.RequestUnavailable=10]="RequestUnavailable",e[e.InvalidParamValue=11]="InvalidParamValue",e[e.WrongPinCode=12]="WrongPinCode"})(l||(l={}));const A={[l.Success]:"No error",[l.InvalidCommand]:"Invalid command",[l.InvalidAddress]:"Invalid address",[l.InvalidValue]:"Invalid value",[l.ConnectFail]:"Connection request failed (Receiver)",[l.TooManyDevices]:"Too many devices connected (Receiver)",[l.AlreadyExists]:"Already exists (Receiver)",[l.Busy]:"Busy (Receiver)",[l.UnknownDevice]:"Unknown device (Receiver)",[l.ResourceError]:"Resource error (Receiver)",[l.RequestUnavailable]:"Request not valid in current context",[l.InvalidParamValue]:"Request parameter has unsupported value",[l.WrongPinCode]:"The PIN code entered on the device was wrong"};function S(...e){let t=0;for(const r of e)r&&(t+=r.byteLength);const n=new Uint8Array(t);let i=0;for(const r of e)r&&(n.set(new Uint8Array(r),i),i+=r.byteLength);return n.buffer}class U{constructor(t,n,i){this._mutex=new P,this._featureIdToIndex={},this.handleInputReport=({data:r})=>{const o=new Uint8Array(r.buffer),s=o[0];{const h=o[1],f=o[2],p=r.buffer.slice(3);console.log(`raw message ${s} 0x${h.toString(16).padStart(2,"0")} 0x${f.toString(16).padStart(2,"0")}`,Array.from(new Uint8Array(p)))}if(s!==this.index)return;const d=this._request;if(!d)return;let c=o[1];if(c===143){c=o[2];const h=o[3];if(d.command===c&&d.address===h){const f=o[4];console.error(`error ${c.toString(16)} ${h.toString(16)} ${A[f]}`);const p=new Error(A[f]);p.name="Hidpp1Error",p.code=f,d.resolver.reject(p),this._request=void 0}return}const u=o[2];if(d.command===c&&d.address===u){const h=r.buffer.slice(3);console.log(`response ${s} 0x${c.toString(16)} 0x${(this.version===2?u>>4:u).toString(16)}`,Array.from(new Uint8Array(h))),d.resolver.resolve(h),this._request=void 0}},this.device=t,this.index=n,this.receiver=i,this.index===255&&this.device.addEventListener("inputreport",this.handleInputReport),this.receiver&&(this._mutex=this.receiver._mutex)}getVersion(){return a(this,void 0,void 0,function*(){if(this.version)return;if(this.device.opened||(yield this.device.open()),!this.device.collections.some(n=>{var i;return(i=n.outputReports)===null||i===void 0?void 0:i.some(r=>r.reportId===17)}))this.version=1;else{const n=new w,i=0,r=1<<4;this._request={command:i,address:r,resolver:n},yield this.device.sendReport(17,new Uint8Array([this.index,i,r]));try{yield n.promise,this.version=2}catch(o){if(o instanceof Error&&o.name==="Hidpp1Error"&&o.code===l.InvalidCommand)this.version=1;else throw o}}})}getFeature(t){return a(this,void 0,void 0,function*(){if(yield this.getVersion(),this.version===1)throw new Error("Feature not supported in HID++ 1.0");if(this._featureIdToIndex[t])return this._featureIdToIndex[t];const n=new ArrayBuffer(2);new DataView(n).setUint16(0,t);const i=yield this.request(17,0,0,n),r=new Uint8Array(i),o=r[0];if(o===0)throw new Error("Feature not supported");const s=r[2];return this._featureIdToIndex[t]={index:o,version:s},{index:o,version:s}})}request(t,n,i,r){return a(this,void 0,void 0,function*(){if(!this.version)throw new Error("Unknown device version");yield this._mutex.wait();try{this.device.opened||(yield this.device.open()),L&&console.log(`request 0x${n.toString(16)} 0x${i.toString(16)}`,r?Array.from(new Uint8Array(r)):""),this.version===2&&(i=i<<4);const o=new w;return this._request={command:n,address:i,resolver:o},yield this.device.sendReport(t,S(new Uint8Array([this.index,n,i]),r)),yield o.promise}finally{this._mutex.notify()}})}}function C(e){return e.collections.some(t=>t.usagePage===65347||t.usagePage===65280)}function V(){return a(this,void 0,void 0,function*(){const e=yield window.navigator.hid.requestDevice({filters:[N]});if(e.length===0)throw new Error("No device selected");const t=e.find(C);if(!t)throw new Error("Device not recognized");return t})}class k{constructor(t){this.children=[],this.childAddedEvent=new E,this.onChildAdded=this.childAddedEvent.event,this.handleInputReport=({data:n})=>{var i;const r=new Uint8Array(n.buffer),o=r[0];if(o!==255){if(r[1]===65){this.childAddedEvent.fire(this.getChild(o));return}(i=this.children[o])===null||i===void 0||i.handleInputReport({data:n})}else{const s=r[1],d=r[2],c=n.buffer.slice(3);console.log(`raw message ${o} 0x${s.toString(16).padStart(2,"0")} 0x${d.toString(16).padStart(2,"0")}`,Array.from(new Uint8Array(c)))}},this.hidpp=t,this.hidpp.device.addEventListener("inputreport",this.handleInputReport)}getChildCount(){return a(this,void 0,void 0,function*(){if(yield this.hidpp.getVersion(),this.hidpp.version!==1)throw new Error("Unsupported version");const t=yield this.hidpp.request(16,129,2);return new Uint8Array(t)[1]})}detectChildren(){return a(this,void 0,void 0,function*(){yield this.hidpp.request(16,128,2,new Uint8Array([2]).buffer)})}getChild(t){return this.children[t]||(this.children[t]=new U(this.hidpp.device,t,this.hidpp)),this.children[t]}}class M{constructor(t){this.hidpp=t}getReportRateList(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(32864),n=yield this.hidpp.request(17,t,0),r=new Uint8Array(n)[0],o=[];for(let s=0;s<8;s+=1)r&1<<s&&o.push(s+1);return o})}getReportRate(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(32864),n=yield this.hidpp.request(17,t,1);return new Uint8Array(n)[0]})}setReportRate(t){return a(this,void 0,void 0,function*(){const{index:n}=yield this.hidpp.getFeature(32864);yield this.hidpp.request(17,n,2,new Uint8Array([t]))})}}const T=new TextDecoder;var I;(function(e){e[e.Keyboard=0]="Keyboard",e[e.RemoteControl=1]="RemoteControl",e[e.Numpad=2]="Numpad",e[e.Mouse=3]="Mouse",e[e.TouchPad=4]="TouchPad",e[e.Trackball=5]="Trackball",e[e.Presenter=6]="Presenter",e[e.Remote=7]="Remote",e[e.Receiver=8]="Receiver"})(I||(I={}));class O{constructor(t){this.hidpp=t}getNameLength(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(5),n=yield this.hidpp.request(17,t,0);return new Uint8Array(n)[0]})}getName(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(5),n=yield this.getNameLength();let i=new Uint8Array(n);for(let r=0;r<n;r+=16){const o=yield this.hidpp.request(17,t,1,new Uint8Array([r]).buffer);i.set(new Uint8Array(o,0,Math.min(n-r,16)),r)}return T.decode(i)})}getType(){return a(this,void 0,void 0,function*(){const{index:t}=yield this.hidpp.getFeature(5),n=yield this.hidpp.request(17,t,2);return new Uint8Array(n)[0]})}}const j=document.getElementById("root"),R=[];async function b(e){if(await e.getVersion(),console.log(e),e.version===1){const n=new k(e);console.log(n);const i=await n.getChildCount();console.log("childrenCount",i),n.onChildAdded(r=>b(r)),await n.detectChildren();return}const t=document.createElement("div");try{const n=new O(e);let i=document.createElement("div");i.textContent=`${e.index} - ${await n.getName()}`,t.appendChild(i),i=document.createElement("div"),i.textContent=`Type: ${I[await n.getType()]}`,t.appendChild(i)}catch{}try{const n=new D(e),i=document.createElement("div");i.textContent="Features: ";let r=0;for await(const o of n.getFeatures())i.textContent+=`0x${r.toString(16)}=0x${o.toString(16).padStart(4,"0")} `,r+=1;t.appendChild(i)}catch{}try{const n=new y(e),{percentage:i,nextPercentage:r,status:o}=await n.getBattery();console.log("battery",i,r,o);const s=document.createElement("div");s.textContent=`Battery: about ${i}%, ${g[o]}`,t.appendChild(s)}catch{}try{const n=new y(e),{voltage:i,flags:r}=await n.getBatteryV1();console.log("battery",i,r,status);const o=document.createElement("div");o.textContent=`Battery: ${i}mV, ${x[r]}`,t.appendChild(o)}catch{}try{const n=new y(e),{percentage:i,level:r,status:o}=await n.getBatteryV4();console.log("battery",i,r,o);const s=document.createElement("div");s.textContent=`Battery: ${i?`${i}%`:m[r]}, ${g[o]}`,t.appendChild(s)}catch{}try{const n=new _(e),i=await n.getSensorCount();for(let r=0;r<i;r+=1){const o=r,s=await n.getDpiList(o),d=await n.getDpi(o),c=document.createElement("div");c.textContent=`Sensor ${o} DPI: `;const u=document.createElement("select");for(const h of s){const f=document.createElement("option");f.value=h.toString(),f.innerText=h.toString(),u.appendChild(f)}u.value=d.toString(),u.onchange=async()=>{console.log(u.value),await n.setDpi(o,parseInt(u.value,10))},c.appendChild(u),t.appendChild(c)}}catch{}try{const n=new M(e),i=await n.getReportRateList(),r=await n.getReportRate(),o=document.createElement("div");o.textContent="Report Rate: ";const s=document.createElement("select");for(const d of i){const c=document.createElement("option");c.value=d.toString(),c.innerText=`${d}ms`,s.appendChild(c)}s.value=r.toString(),s.onchange=async()=>{console.log(s.value),await n.setReportRate(parseInt(s.value,10))},o.appendChild(s),t.appendChild(o)}catch{}j.appendChild(t)}async function F(e){R.includes(e)||(R.push(e),console.log(e),await b(new U(e,255)))}(async()=>{const e=await navigator.hid.getDevices();for(const t of e)C(t)&&await F(t)})();document.getElementById("select-button").onclick=async()=>{const e=await V();R.includes(e)||(console.log(e),await F(e))};
